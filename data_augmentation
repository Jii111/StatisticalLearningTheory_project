import os
import numpy as np
import cv2
from matplotlib.pyplot import imshow, subplots
from PIL import Image
from torchvision import transforms
import albumentations

from google.colab import drive
drive.mount('/content/drive')

def image_augmentation(image_folder):
    # 이미지 폴더 내의 모든 이미지 파일 가져오기
    img_files = [f for f in os.listdir(image_folder) if f.endswith(('.jpg'))]

    for img_file in img_files:
        img_path = os.path.join(image_folder, img_file)
        img = cv2.imread(img_path)

        imgArray = np.array(img)  # 이미지 분석을 위해 배열 전환

        # Display original image
        imshow(Image.fromarray(imgArray))


        # torchvision을 이용하여 밝기, 대비, 채도, 색상을 조절(4가지 생성)
        fig, ax = subplots(2, 2, figsize=(9, 9))

        loader_transform1 = transforms.ColorJitter(brightness=2)
        loader_transform2 = transforms.ColorJitter(contrast=2)
        loader_transform3 = transforms.ColorJitter(saturation=2)
        loader_transform4 = transforms.ColorJitter(hue=0.3)

        img_aug1 = loader_transform1(Image.fromarray(imgArray))
        img_aug2 = loader_transform2(Image.fromarray(imgArray))
        img_aug3 = loader_transform3(Image.fromarray(imgArray))
        img_aug4 = loader_transform4(Image.fromarray(imgArray))

        ax[0, 0].imshow(np.array(img_aug1))
        ax[0, 1].imshow(np.array(img_aug2))
        ax[1, 0].imshow(np.array(img_aug3))
        ax[1, 1].imshow(np.array(img_aug4))

        # 1/2의 확률로 좌우반전
        transform1 = albumentations.HorizontalFlip(p=0.5)
        augmented_image1 = transform1(image=imgArray)['image']
        ax[0, 0].imshow(augmented_image1)

        # 1/2 확률로 돌리거나 이동
        transform2 = albumentations.ShiftScaleRotate(p=0.5)
        augmented_image2 = transform2(image=imgArray)['image']
        ax[0, 1].imshow(augmented_image2)

        fig.show()

        # 위 이미지들 이용하여 좌우반전 / 회전 / 이동 / 밝기, 대비, 채도, 색상 조절 (6x6)

        fig, ax = subplots(6, 6, figsize=(12, 12))

        transform3 = albumentations.HorizontalFlip(p=0.5)
        transform4 = albumentations.ShiftScaleRotate(p=0.5)

        loader_transform = transforms.ColorJitter(brightness=2, contrast=2, saturation=2, hue=0.2)

        for i in range(6):
            for j in range(6):
                newimg = transform3(image=imgArray)['image']
                newimg = transform4(image=newimg)['image']
                newimg = loader_transform(Image.fromarray(newimg))

                ax[i, j].imshow(newimg)

        fig, ax = subplots(3, 3, figsize=(12, 12))
 

# path to image folder
image_folder_path = '/content/drive/MyDrive/폴더명~'
image_augmentation(image_folder_path)
